
U盘模式
===========================

虚谷号可以通过U盘模式进行编程，不需要接上显示器和鼠标键盘，即可使用。这是虚谷号在教学应用方面的最大特色。

U盘模式也称DAP虚拟磁盘烧录模式，是指虚谷号通过USB线将OTG口和电脑USB口连接后，电脑上将出现一个虚拟的U盘。将Arduino、Python代码复制到U盘的相应目录后，按下RST键，U盘的盘符将暂时消失，当再次出现盘符时，程序已经成功执行。

-----------------------------------
应用场景
-----------------------------------

虚谷号是为大班教学设计的。在机房里，如果虚谷号要接上鼠标键盘显示器才能使用，这样的实施条件是非常高的。首先机房中要准备原数量一倍以上的显示器，这几乎无法做到。哪怕两人为一组，这些显示器也没有地方摆放。加一个视频分配器吗？看起来也不可行。其次，机房中还要准备大量的鼠标键盘，这也是做不到的。正是这样的因素，导致树莓派难以在中小学中使用。

.. image:: ../images/02/u-driver01.jpg

可见，不需要接上显示器和鼠标键盘，即可使用虚谷号，这是很重要的教学功能。虚谷号就成了和Arduino、micro:bit和掌控板一样的，即插即用、使用方便的开源硬件了。

**场景1**:

大班教学应用。教师不需要改变现有的机房条件和教学习惯，把虚谷号作为掌控板来教学，但是其各方面的性能远超常见的开源硬件。

**场景2**:

快速移植应用。当用户在电脑上调试好Python或者Ardunio代码，用U盘模式可以快速将代码移植到虚谷号上。

---------------------------------------------------
功能介绍
---------------------------------------------------

- 设置虚谷号的系统参数。

	- 设置虚谷号的Wi-Fi参数，查看IP地址；
	- 设置是否启动Jupyter、SIoT等系统服务。

- 编程。可以给虚谷号编程。

	- 编写Arduino代码；
	- 编写Python代码。

-------------------------------------------
操作流程
-------------------------------------------

1）设置Wi-Fi参数

更改U盘vvboard文件夹的”vvBoard_config.ini”中，SSID和SSID_PSD。短按RST键重启U盘服务，然后在U盘vvboard文件夹的“wifi_log.txt”中，找到IP地址。

【截图，做记号】

2）烧录Arduino代码

复制标准arduino代码到U盘的Arduino文件夹下，命名为“arduino.ino”，按下RST键，U盘的盘符将暂时消失，约十秒钟左右，板子上有LED闪烁，表示虚谷号将代码写入板载Arduino。

【截图，做记号】

如果没有发现板子上的LED闪烁，请打开log文件检查原因。烧录成功的ino文件将移到BAK文件夹。

1）运行Python文件

复制标准的Python代码（如将下面的代码复制到一个新的文本文件）到U盘的Pythono文件夹下，命名为“mian.py”，按下RST键，U盘的盘符将暂时消失，当再次出现盘符时，程序已经成功执行。

::
	f= open('print.txt', 'wb')
	line="你好，虚谷号！"
	f.write(line.encode())
	f.close()
 
看一下，目录下是否出现一个“print.txt”文件？

【截图，做记号】

如果Python代码中调用了xugu库，虚谷号系统将判断板载Arduino是否已经写入firmata协议（如果没有则自动写入，要延时一定的时间，并且可以看到板子上的LED闪烁），然后运行代码。

哪怕断电重启虚谷号，Pythono文件夹下的“mian.py”都会保持开机运行，除非删除。打开log文件，可以看到Python代码的运行情况。

【截图，做记号】

**注意：如何实现python和Arduino的自定义互动？

（1）先复制标准arduino代码，虚谷号将代码写入板载Arduino。

（2）再复制标准python代码，虚谷号开始运行Python代码。

（3）如果标准的arduino和python代码都复制了，虚谷号会先运行arduino代码，再运行Python代码。

-------------------------------------------
U盘资源简介
-------------------------------------------

> 1、arduino_config.ini:配置运行的arduino程序（当运行的程序不是Arduino.ino或者arduino.ino形式命名则需配置）

2、arduino_log.txt:arduino代码的编译、烧录的回写日志

3、Aeduino/04.bak：存放刚运行完的程序，下次运行新的程序将会被替换

4、python_config.ini:配置运行的python程序（当运行的程序不是main.py或者Main.py形式命名则需配置）

5、python_log.txt:python程序检测发现错误的回写日志

6、vvBoard_config.ini:配置WiFi连接及打开jupyter和siot服务

7、wifi_log.txt:wifi连接上回写的连接日志

8、REDAME.txt:虚谷号信息显示

9、Notepad2:文档编辑器

关于U盘文件的详细介绍，请浏览本文档的第八部分。


