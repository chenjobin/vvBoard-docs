%% Generated by Sphinx.
\def\sphinxdocclass{report}
\documentclass[letterpaper,10pt,english]{sphinxmanual}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax

\usepackage[utf8]{inputenc}
\ifdefined\DeclareUnicodeCharacter
 \ifdefined\DeclareUnicodeCharacterAsOptional
  \DeclareUnicodeCharacter{"00A0}{\nobreakspace}
  \DeclareUnicodeCharacter{"2500}{\sphinxunichar{2500}}
  \DeclareUnicodeCharacter{"2502}{\sphinxunichar{2502}}
  \DeclareUnicodeCharacter{"2514}{\sphinxunichar{2514}}
  \DeclareUnicodeCharacter{"251C}{\sphinxunichar{251C}}
  \DeclareUnicodeCharacter{"2572}{\textbackslash}
 \else
  \DeclareUnicodeCharacter{00A0}{\nobreakspace}
  \DeclareUnicodeCharacter{2500}{\sphinxunichar{2500}}
  \DeclareUnicodeCharacter{2502}{\sphinxunichar{2502}}
  \DeclareUnicodeCharacter{2514}{\sphinxunichar{2514}}
  \DeclareUnicodeCharacter{251C}{\sphinxunichar{251C}}
  \DeclareUnicodeCharacter{2572}{\textbackslash}
 \fi
\fi
\usepackage{cmap}
\usepackage[T1]{fontenc}
\usepackage{amsmath,amssymb,amstext}
\usepackage{babel}
\usepackage{times}
\usepackage[Sonny]{fncychap}
\usepackage[dontkeepoldnames]{sphinx}

\usepackage{geometry}

% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}

\addto\captionsenglish{\renewcommand{\figurename}{Fig.}}
\addto\captionsenglish{\renewcommand{\tablename}{Table}}
\addto\captionsenglish{\renewcommand{\literalblockname}{Listing}}

\addto\captionsenglish{\renewcommand{\literalblockcontinuedname}{continued from previous page}}
\addto\captionsenglish{\renewcommand{\literalblockcontinuesname}{continues on next page}}

\addto\extrasenglish{\def\pageautorefname{page}}

\setcounter{tocdepth}{1}



\title{虚谷号文档}
\date{Aug 20, 2019}
\release{1.0}
\author{}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{Release}
\makeindex

\begin{document}

\maketitle
\sphinxtableofcontents
\phantomsection\label{\detokenize{contents::doc}}



\chapter{关于虚谷号}
\label{\detokenize{01.about/index::doc}}\label{\detokenize{01.about/index:id1}}
这一部分主要介绍虚谷号的由来、功能设计、周边生态等。


\section{虚谷号的故事}
\label{\detokenize{01.about/1.1-story:id1}}\label{\detokenize{01.about/1.1-story::doc}}
自从“虚谷号”的消息发布以来，常常有熟悉的创客老师问有关“虚谷号”的细节。他们很好奇，我们为什么会设计一款新的开源硬件。是受到“中兴事件”的刺激而想要有一款中国芯的开源硬件，还是在各种融资的好消息刺激下，也要做款产品赚点钱？当然，他们更多是关心这一开源硬件具有怎样的特点，是否更加适用于中小学，帮助他们能够更好地开展创客教育。


\subsection{虚谷号的缘起}
\label{\detokenize{01.about/1.1-story:id2}}
如果认真追溯下去，设计虚谷号的理由也许很复杂，也许真的关乎爱国，关乎情怀。参与“虚谷计划”的每一个成员，背后都有一个关乎教育关乎技术教育的故事。但要归纳一个最核心的理由却是简简单单的一句话：

我们找不到想要的开源硬件。

想设计一款新的开源硬件，最初的动机产生于2016年。那一年，我接受浙江教育出版社的邀请，成为普通高中信息技术教材编写组的一员，参与必修2《信息技术与社会》模块的编写，还担任选择性必修《开源硬件项目设计》模块的主编。在2016年，除了Arduino和树莓派，我真的不知道写开源硬件教材还有别的选择。但很明确的是，二者都不是理想的选择。

众所周知，即将出版的所有的高中信息技术新教材都放弃了VB，转而选择Python。在这种背景下，教材选择哪些开源硬件变得更加困难。为什么？我来分析一下：

如果选择Arduino。

Arduino的编程语言是C/C++，那么这套教材就很奇怪：其他的模块都用Python语言，到了《开源硬件项目设计》模块，就转到C/C++语言。且不提学生们没有C的基础能不能正常学习，一套教材总要考虑整体统一，在全部是Python的教学内容中硬生生插入C，是不是有一种强烈的违和感？Arduino没有基于Python的IDE，鉴于高中生的学习能力，又不能使用Mixly或者ArduBlock之类的图形化编程环境。我们可以大致推算一下，当新教材全面实施的时候，目前在小学初中接触过开源硬件的学生刚好升到了高中。那就很尴尬了，学生们应该会嘀咕：小学mixly、初中mixly，到了高中还是Mixly，这编教材的在耍我吗？

如果选择树莓派。

作为一款Linux电脑，树莓派当然支持Python。但是，树莓派算不算一款开源硬件，圈子里还一直争论不休（要知道，树莓派连芯片都是定制、特供的。）最重要的是，用树莓派没法上课！您说，如果用树莓派来上课，机房里要准备几个屏幕？几套键盘？直接部署一个树莓派机房吗？老师怎么管理？有Linux下的机房管理软件吗？这些问题我们不得不考虑。我们曾经尝试上过一个学年的树莓派教学，的确很不方便。因此，无论是国内还是国外，在大班教学中用树莓派几乎不可见。还有，树莓派的技术门槛也太高，大家可以调查一下，一个地级市能直接在Linux环境下上信息技术课的老师有几个？


\subsection{我们需要怎样的开源硬件}
\label{\detokenize{01.about/1.1-story:id3}}
2016年底，我拿到了第一块micro:bit。一测试我就喜欢上了：软件友好，操作简单，只要感兴趣，谁都能为这块板子写一段简单代码体验硬件控制。虽然，micro:bit官方推荐使用图形化编程，但很快就有了MicroPython的移植版本，在编程和语法规范上与Python3一致，这样一来，总算找到了一款简单易用的支持Python的开源硬件。2017这一年，我都在努力推广micro:bit。说服DF、盛思等企业开发micro:bit的周边产品，做培训，写教材，拍微课，并因此成为micro:bit基金会的中国推广大使。但我也清楚地认识到，micro:bit并不是一块理想的适合高中生学习编程的开源硬件，理由如下。

其一，板子性能太差。说是支持MicroPython，其实是阉割的MicroPython。只要写几句和字符处理相关的功能，板子就会死机。
其二，板子不支持无线网络（Wi-Fi）。没有网络功能的开源硬件，和不能上网的电脑一样，功能大打折扣废了一半。为了让micro:bit能联网，我找了好多借口说服DF做了一块IOT模块。对，就是那款大家用来做物联网的OBLOQ模块。虽然能上网了，但因为字符处理能力太弱，写不了稍微复杂一点的代码。
其三，板子的扩展板不好做。我不知道micro:bit的开发团队是怎么考虑的，micro:bit自身看起来清清爽爽，颜值不错，但是一旦接上任何板子，马上就变LOW了。要么太大，要么破坏原来的设计，扩展功能极其有限，非常鸡肋……

不断寻找，不断失望。我们想要怎样的开源硬件？说起来要求也不高，就是入门要简单，扩展要方便，就如Python语言一样，适合非专业的人使用，也能写出非常复杂的如机器学习方面的代码。Arduino再好，它毕竟不是为教育而设计。micro:bit再好，只能在入门时玩玩。树莓派再好，也只能适合那些玩Linux的高手。所以，当来自教育管理部门的教研员或者高校的研究者问我：小学用micro:bit，初中用Arduino，高中用树莓派，可以吗？

不可以！micro:bit、Arduino和树莓派，这三者无法形成一个循序渐进的学习体系。micro:bit和Arduino，几乎是完全不同的体系，Arduino和树莓派，也不是一个知识体系。当你试图考虑中小学的开源硬件学习路径的时候，现有的产品就存在很大的问题。这种尴尬，在我参与编写教育部综合实践活动指导纲要的时候，变得更加强烈。

决心重新自己设计一块教学用开源硬件想法，则是在2017年11月的台北makerFaire上。感谢鸿海科技的工程师张志铭，他的一句话提醒我了：你们做老师的不提出需求，我们工程师怎么知道要做什么教育产品？是啊，从2010年买第一块Arduino开始，我已经玩了八年的开源硬件。感谢各个创客企业朋友的信任，每出一块新的开源硬件或者模块，都会快递一份让我“尝鲜”，对常见和不常见的开源硬件都有所了解。我们身边的朋友，如梁森山、叶琛、李大维等，很早就开始接触开源硬件，是资深的玩家。Dfrobot和Seeed Studio在开源硬件销售方面全球排名前五，他们生产的开源硬件和周边模块销往世界各地。厚积薄发，是时候提出自己的想法了。


\subsection{我们的行动}
\label{\detokenize{01.about/1.1-story:id4}}
创意当实现！在台北，我连夜打了几个“越洋”电话给梁森山、余翀、叶琛等，得到他们的明确支持。当天晚上，我做了一个PPT，给这一块板子取名“虚谷”，其寓意是：虚怀若谷，兼容并蓄，继往开来。这款新的开源硬件要继承Arduino、树莓派、micro:bit等开源硬件的优点，而不是另起炉灶重新造一个“轮子”，用一句话去描述开发目标：技术门槛如micro:bit一样低，支持Python和网络，支持虚拟磁盘烧录，性能和成本优于树莓派，能够兼容大部分Arduino项目。

一个月后，在北京一个以“人工智能教育”为主题的研讨会上，我介绍了“虚谷”这一开源硬件的想法，引起了深圳希科普公司CEO刘军的兴趣。过了年，他很快就组了一个团队开始研发。随后，李大维、吴俊杰、管雪沨、周茂华、樊磊、程晨等信息技术教育专家或者教育创客先后加入，这块板子的最终名称确定为“虚谷号”。

2018年5月4日——第一块虚谷号（测试版）正式亮相！

\noindent\sphinxincludegraphics{{vvboard01}.jpg}

** 注：本文由“虚谷计划”组委会谢作如老师撰写


\section{虚谷号的功能}
\label{\detokenize{01.about/1.2-function:id1}}\label{\detokenize{01.about/1.2-function::doc}}
虚谷号主处理器采用国产高性能4核处理器，主频高达1.5GHz，板载1G RAM和8G ROM存储空间，提供高速大容量运算处理能力，内置Mali-450MP2 GPU,支持OpenGL ES1.1/2.0，拥有优秀的图像处理能力。

虚谷号带有一个USB2.0通用接口，可挂载摄像头等各种通用外设;一个USB3.0接口，提供高速通用的外接通信能力，可挂载大容量高速的硬盘，高速通信的多媒体模组和AI模组;一个USB2.0 OTG接口，此接口向系统供电并 可作为使用者的开发接口，以及虚谷号作为从设备的通信接口;一个HDMI接口，提供高清的音视频输出;无线通信模组，提供WIFI和蓝牙通信功能。

虚谷号内置国产单片机，用于处理实时事件，扩展接口兼容Arduino UNO，提供多种数字和模拟接口(如1*UART/14*GPIO/4*PWM/6*ADC等)，同时兼容Arduino UNO和树莓派接口功能。

虚谷号运行开源的Linux桌面系统，内置Python(jupyter notebook)、 Arduino、Processing、Scratch等开发学习软件可以为初高级编程爱好者提供 完整的学习和开发环境。


\subsection{系统}
\label{\detokenize{01.about/1.2-function:id2}}\begin{itemize}
\item {} 
SOC系统: Run Linux ubuntu desktop OS

\item {} 
PYTHON: jupyter/notebook

\item {} 
CPU: Quad-core Cortex-A53 up to 1.5GHz

\item {} 
MCU: 8bit Flash MCU，16-32MHz，兼容Arduino UNO，内置xugu通信协议

\item {} 
GPU: Mali-450MP2,支持OpenGL ES1.1/2.0

\item {} 
DDR: 32bit 位宽,1GB,LPDDR3(可扩展到2G/4)

\item {} 
eMMC: 8GB, 支持eMMC 4.41, 4.51, 5.0 and 5.1(亦可扩展到 16G/32G/64G)

\end{itemize}


\subsection{开源硬件接口}
\label{\detokenize{01.about/1.2-function:id3}}\begin{itemize}
\item {} 
I2C: 一组I2C，3.3V电平信号，5V供电;

\item {} 
ISPI(I2S):1. 一组SPI接口(兼容I2S)，3.3V电平; 2. SPI(I2S)支持主从模式;

\item {} 
IUART2:一组UART，兼作虚谷号内核调试，系统信息打印等;

\item {} 
IIR\_R:一个红外遥控输入接口，输入电平3.3V，提供红外(遥控) 控制接口。

\item {} 
ARDUINO接口:全兼容arduino接口;

\end{itemize}


\subsection{外部硬件接口}
\label{\detokenize{01.about/1.2-function:id4}}\begin{itemize}
\item {} 
mini HDMI: 1.HDMI 2.0a支持4K×2K 60Hz显示，支持HDCP 1.4/2.2；2.HDMI type C

\item {} 
USB: 1. 1个Micro OTG接口，OTG模式支持U盘模式(device 模式)；2. 1个Micro USB作备用电源接口；3. USB2.0、USB3.0接口各一个（HOST A Type）;

\item {} 
KEY: Linux系统复位按键

\item {} 
WIFI/BT: WIFI IEEE 802.11 b/g/n; Bluetooth V4.0(HS)

\item {} 
LED: 3个LED灯用于指示虚谷号的运行状态

\end{itemize}


\subsection{自带软件}
\label{\detokenize{01.about/1.2-function:id5}}\begin{itemize}
\item {} 
Python（）

\item {} 
Arduino（）

\item {} 
MpythonX（）

\item {} 
Processing（）

\item {} 
S4A（1.6版）

\item {} 
SIoT（1.2版）

\end{itemize}


\section{虚谷号大事记}
\label{\detokenize{01.about/1.3-log:id1}}\label{\detokenize{01.about/1.3-log::doc}}
虚谷号从想法萌发到正式发布，经历了很多曲折。

如下为记录：
\begin{itemize}
\item {} 
2018年1月20日，希科普启动预研

\item {} 
2018年2月22日，项目启动

\item {} 
2018年3月17日，虚谷工作组成立

\item {} 
2018年3月17日，明确硬件定义

\item {} 
2018年3月28日，虚谷V1.0原理图完成

\item {} 
2018年3月30日，虚谷板背面标识确认

\item {} 
2018年4月5日，虚谷V1.0 PCB Layout完成

\item {} 
2018年4月15日，首师大樊磊教授到深圳，开启虚谷示教板V1.0

\item {} 
2018年4月19日，虚谷号logo确认

\item {} 
2018年4月21日，虚谷号示教板V1.0确认

\item {} 
2018年4月21日，虚谷号示教板V2.0开始

\item {} 
2018年4月22日，虚谷号示教板软件确认

\item {} 
2018年4月28日，虚谷号V1.0完成

\item {} 
2018年5月1日，虚谷号V2.0启动

\item {} 
2018年6月5日，虚谷号V2.0PCB Layout完成

\item {} 
2018年6月11日，虚谷号示教板V2.0完成

\item {} 
2018年6月24日，华东师大任友群校长参观希科普，确认虚谷号示教板可以帮助信息技术教学工作

\item {} 
2018年6月25日，虚谷号英文名称确认

\item {} 
2018年6月29日，虚谷号V2.0完成

\item {} 
2018年7月9日，虚谷号V3.0启动

\item {} 
2018年7月9日，虚谷号示教板V3.0启动

\item {} 
2018年7月20日，虚谷号示教板V3.0原理图完成

\item {} 
2018年7月26日，虚谷号软件确认

\item {} 
2018年7月28日，虚谷号示教板V3.0PCB Layout完成

\item {} 
2018年7月31日，虚谷号V3.0原理图完成

\item {} 
2018年8月2日，虚谷号示教板V3.0完成

\item {} 
2018年8月5日，虚谷号V3.0PCB Layout完成

\item {} 
2018年8月10日，虚谷号V3.0完成

\item {} 
2018年12.30，虚谷号官方网站正式开通

\item {} 
2019年12月23-24，虚谷号在英国BETT展会上展示

\item {} 
2019年1月26-27，虚谷号在中泰创客教育文化节上展示并做了三期的工作坊

\item {} 
2019年3月8日，虚谷号亮相联合国教科文组织“移动学习周”活动的战略实验室环节

\end{itemize}


\section{虚谷号的产品生态}
\label{\detokenize{01.about/1.4-ecology:id1}}\label{\detokenize{01.about/1.4-ecology::doc}}
虚谷号不是一个完全独立的教育产品，正如“虚谷计划”的本意——虚怀若谷、兼容并蓄，虚谷号可以完美继承Arduino和树莓派的软硬件生态。


\subsection{硬件方面}
\label{\detokenize{01.about/1.4-ecology:id2}}
1.Arduino周边器材

虚谷号板载了一块328P芯片，和Arduino UNO的芯片完全一致。其针脚也完全兼容UNO。几乎所有的UNO能使用的硬件模块，虚谷号都可以使用。在虚谷号上使用各种传感器，不需要像树莓派一样麻烦，插上Arduino扩展板即可。

2.USB接口硬件
\begin{itemize}
\item {} 
摄像头。绝大多数的免驱摄像头，都可以使用在虚谷号上。

\item {} 
……

\end{itemize}

3.蓝牙接口硬件


\subsection{软件方面}
\label{\detokenize{01.about/1.4-ecology:id3}}
1、树莓派软件

2、Linux软件


\section{虚谷号的文档资源}
\label{\detokenize{01.about/1.5-docs:id1}}\label{\detokenize{01.about/1.5-docs::doc}}
虚谷号是一款开源硬件，官方文档全部采用CC-BY协议共享。


\subsection{虚谷号的网络资源}
\label{\detokenize{01.about/1.5-docs:id2}}\begin{itemize}
\item {} 
官网链接：\sphinxurl{http://www.vvboard.com.cn/}

\item {} 
论坛链接：\sphinxurl{http://www.vvboard.com.cn/bbs/}

\item {} 
固件及文档下载链接：\sphinxurl{http://www.vvboard.com.cn/plus/view.php?aid=6}

\item {} 
微信公众号：虚谷号

\end{itemize}


\subsection{虚谷号的板载资源位置}
\label{\detokenize{01.about/1.5-docs:id3}}\begin{itemize}
\item {} 
使用说明书在桌面或者在vvBoard/docs下查找

\item {} 
虚谷号文档所在路径：vvBoard/docs

\item {} 
版本查询命令：在LX终端输入uname

\end{itemize}


\subsection{虚谷号的文档维护团队}
\label{\detokenize{01.about/1.5-docs:id4}}
虚谷号文档维护团队由温州中学谢作如老师领衔，由希科普的工程师和国内创客、一线教师、高校学生等组成。

对本文档有贡献的人员名单：
\begin{itemize}
\item {} 
谢作如（浙江省温州中学）

\item {} 
张何为（希科普）

\item {} 
……

\end{itemize}


\chapter{虚谷号快速入门}
\label{\detokenize{02.quick/index:id1}}\label{\detokenize{02.quick/index::doc}}
这一部分主要介绍虚谷号的几种实用模式，引领用户快速掌握基本用法。


\section{U盘模式}
\label{\detokenize{02.quick/2.1-dap:u}}\label{\detokenize{02.quick/2.1-dap::doc}}
虚谷号可以通过U盘模式进行编程，不需要接上显示器和鼠标键盘，即可使用。

U盘模式也称DAP虚拟磁盘烧录模式，是指虚谷号通过USB线将OTG口和电脑USB口连接后，电脑上将出现一个虚拟的U盘。将Arduino、Python代码复制到U盘的相应目录后，按下RST键，U盘盘符将暂时消失，当再次出现盘符时，程序已经成功执行。


\subsection{应用场景}
\label{\detokenize{02.quick/2.1-dap:id1}}
不需要接上显示器和鼠标键盘，即可使用虚谷号。当用户在电脑上调试好Python或者Ardunio代码，用U盘模式可以快速将代码移植到虚谷号上。


\subsection{通过U盘模式可以做什么？}
\label{\detokenize{02.quick/2.1-dap:id2}}\begin{itemize}
\item {} \begin{description}
\item[{设置虚谷号系统参数。}] \leavevmode\begin{itemize}
\item {} 
设置虚谷号的Wi-Fi参数，查看IP地址；

\item {} 
设置是否启动Jupyter、SIoT等系统服务。

\end{itemize}

\end{description}

\item {} 
编程。可以给虚谷号编程。

\end{itemize}


\subsection{虚谷号U盘模式详解}
\label{\detokenize{02.quick/2.1-dap:id3}}
1、普通python代码

复制标准python代码，虚谷号系统运行代码
工具：官方ide、mPython（虚谷版）、BXY（虚谷版）

2、标准arduino代码

复制标准arduino代码，虚谷号系统将代码写入板载Arduino。
工具：Arduino ide、mixly（虚谷版）、Ardublock

3、驱动arduino的python（基于firmata协议）

复制标准python代码，代码中调用firmata库，虚谷号系统将判断板载Arduino是否已经写入firmata协议（如果没有则自动写入，要延时一定的时间），然后运行代码。
工具：官方ide、mpython（虚谷版）、BXY（虚谷版）

4、同时实现python和Arduino的互动（非firmata协议）

（1）先复制标准arduino代码，虚谷号将代码写入板载Arduino。
（2）再复制标准python代码，虚谷号开始运行Python代码。


\section{无线模式}
\label{\detokenize{02.quick/2.2-wifi:id1}}\label{\detokenize{02.quick/2.2-wifi::doc}}
虚谷号内置了SSH和jupyter服务，在连接Wi-Fi的情况下，可以不用接鼠标键盘，即可实现对虚谷号的控制。


\subsection{应用场景}
\label{\detokenize{02.quick/2.2-wifi:id2}}
在不需要接鼠标键盘的前提下，通过修改config文件连接Wi-Fi的功能，即可用无线模式来管理虚谷号，如：
\begin{itemize}
\item {} 
通过Web页面给虚谷号编写代码；

\item {} 
安装或者卸载软件；

\item {} 
安装Python库；

\item {} 
在线调试代码、管理进程；

\item {} 
熟悉linux命令；

\end{itemize}


\subsection{如何连接Wi-Fi}
\label{\detokenize{02.quick/2.2-wifi:wi-fi}}\begin{itemize}
\item {} 
修改config文件，按下RST键。

\item {} 
打开log文件，找到IP地址。

\end{itemize}


\subsection{SSH功能}
\label{\detokenize{02.quick/2.2-wifi:ssh}}
默认启动了SSH功能，通过SSH功能来启动jupyter或者VNC。


\subsection{jupyter功能}
\label{\detokenize{02.quick/2.2-wifi:jupyter}}
config中增加jupyter=1，默认jupyter=0，并且修改jupyter的密钥


\subsection{通过SSH开启远程桌面}
\label{\detokenize{02.quick/2.2-wifi:id3}}
通过SSH，可以开启远程桌面（tightvncserver）。
步骤：
1）sudo apt install xrdp
2）sudo apt install tightvncserver
用win自带的mstsc.exe远程桌面边接既可。
输入用户名 密码都是：scope


\section{电脑模式}
\label{\detokenize{02.quick/2.3-pc:id1}}\label{\detokenize{02.quick/2.3-pc::doc}}

\section{混合模式}
\label{\detokenize{02.quick/2.4-blend:id1}}\label{\detokenize{02.quick/2.4-blend::doc}}

\chapter{虚谷号的基本操作}
\label{\detokenize{03.basic/index:id1}}\label{\detokenize{03.basic/index::doc}}
这一部分主要介绍虚谷号在电脑模式下的基本操作。虚谷号运行的系统为ubuntu，基本操作和普通Linux系统类似。


\section{Wi-Fi和蓝牙}
\label{\detokenize{03.basic/3.1:wi-fi}}\label{\detokenize{03.basic/3.1::doc}}

\section{软件安装和卸载}
\label{\detokenize{03.basic/3.2:id1}}\label{\detokenize{03.basic/3.2::doc}}

\section{Python运行和升级}
\label{\detokenize{03.basic/3.3:python}}\label{\detokenize{03.basic/3.3::doc}}

\section{虚谷号系统升级}
\label{\detokenize{03.basic/3.4:id1}}\label{\detokenize{03.basic/3.4::doc}}

\section{常见Linux命令}
\label{\detokenize{03.basic/3.5:linux}}\label{\detokenize{03.basic/3.5::doc}}

\chapter{虚谷号的GPIO详解}
\label{\detokenize{04.gpio/index:gpio}}\label{\detokenize{04.gpio/index::doc}}
这一部分主要介绍虚谷号的GPIO，重点介绍xugu库。


\section{GPIO的几种方式}
\label{\detokenize{04.gpio/4.1:gpio}}\label{\detokenize{04.gpio/4.1::doc}}

\section{xugu库的使用}
\label{\detokenize{04.gpio/4.2:xugu}}\label{\detokenize{04.gpio/4.2::doc}}

\chapter{虚谷号软件资源简介}
\label{\detokenize{05.soft/index:id1}}\label{\detokenize{05.soft/index::doc}}
这一部分主要介绍虚谷号的内置软件资源，如S4A、mPythonX、Ardunio、Jupyter、Python和SIoT等。


\section{S4A}
\label{\detokenize{05.soft/5.1-s4a::doc}}\label{\detokenize{05.soft/5.1-s4a:s4a}}
S4A是Scratch for Arduino的缩写,由西班牙的Citilab开发。它主要提供了对Arduino和Andriod的支持：采用Arduino作为传感器和执行器的控制平台，提供了6组模拟输入和2组数字输入接口，以及舵机输出和数字输出接口，具有强大的输入和输出的功能；提供了基于HTTP协议的远程传感器功能和安卓手机的配套程序，可以组网互动，也可以和智能手机进行互动。相对于Scratch来说，S4A编写出的作品交互功能更加强大。

S4A由西班牙的Citilab（社会和数字创新中心）在Scratch的基础上开发完成。其最大的修改是在硬件方面进行了拓展，提供了对Arduino的支持，使软件的输入和输出不在局限与传感器板（PicoBoards）和乐高马达，能够创作出功能更加强大的互动作品。

S4A的官方网站：\sphinxurl{http://seaside.citilab.eu/}


\section{mPythonX}
\label{\detokenize{05.soft/5.2-mPythonX:mpythonx}}\label{\detokenize{05.soft/5.2-mPythonX::doc}}
mPythonX是一款为掌控板开发的图形化编程的软件，同时支持Python代码编程。

mPythonX由盛思开发。

mPython X 使用说明：\sphinxurl{https://mpythonx.readthedocs.io/zh\_CN/latest/mPythonX.html}

mPythonX运行界面

\noindent\sphinxincludegraphics{{mPythonX}.png}


\section{Arduino IDE}
\label{\detokenize{05.soft/5.3-arduino:arduino-ide}}\label{\detokenize{05.soft/5.3-arduino::doc}}
Arduino于2005年开发，起初仅为了方便设计学院的大学生设计互动作品，后来因为开源而快速发展为全球知名的开源硬件平台。Arduino包含硬件（各种型号的Arduino主板）和软件（Arduino IDE) 。虚谷号板载了Arduino UNO版本，也内置了Arduino IDE。

Arduino 语言建立在 C/C++ 基础上，保留了 C/C++的语法规范，并对 Arduino主控芯片底层进行了二次封装，使开发者无需考虑芯片的底层操作，只通过编写简单的代码就可以实现对Arduino芯片的控制。

Arduino 语言常用于兼容Arduino的开源硬件的编程，是目前最流行的开源硬件编程语言之一。下面是Arduino读取模拟接口并打印的示例代码。
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
void setup() \PYGZob{}                          //初始化函数，只在上电时运行一次
        Serial.begin(9600);             //设置串口通信波特率，启动串口通信
\PYGZcb{}
void loop() \PYGZob{}                           //循环函数，在初始化函数之后一直循环运行
        int sensorValue = analogRead(A0);//设置变量，变量值为模拟口A0的输入
        Serial.println(sensorValue);            //通过串口打印变量sensorValue 的值
        delay(1);                                                       //延时1毫秒
\PYGZcb{}
\end{sphinxVerbatim}
\end{quote}


\section{Jupyter}
\label{\detokenize{05.soft/5.4-Jupyter:jupyter}}\label{\detokenize{05.soft/5.4-Jupyter::doc}}
Jupyter的全称为Jupyter Notebook（此前被称为 IPython notebook），是一个交互式笔记本，支持运行40多种编程语言。

JupyterNotebook的本质是一个 Web 应用程序，便于创建和共享文学化程序文档，支持实时代码，数学方程，可视化和 markdown。

通过Jupyter，可以通过Web页面在虚谷号上运行Python代码和Linux命令。


\section{Python}
\label{\detokenize{05.soft/5.5-Python:python}}\label{\detokenize{05.soft/5.5-Python::doc}}
Python是一种面向对象的解释型程序设计语言，是纯粹的开源软件，源代码和解释 器 CPython 遵循 GPL(GNUGeneral Public License)协议。

Python 语法简洁、清晰、自由、灵活，具有丰富和强大的库，常被昵称为“胶水语言”，能够把其他语言(尤其是 C/C++)编写的各种模块很轻松地“粘合”、联结在一起。

例如，在虚谷号中控制引脚的高低电平，让连接在引脚上的LED灯闪烁，代码如下：
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{xugu} \PYG{k}{import} \PYG{n}{pin}
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{n}{led} \PYG{o}{=} \PYG{n}{Pin}\PYG{p}{(}\PYG{l+m+mi}{13}\PYG{p}{,} \PYG{n}{Pin}\PYG{o}{.}\PYG{n}{OUT}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} led引脚初始化}
\PYG{k}{while} \PYG{k+kc}{True}\PYG{p}{:}
        \PYG{n}{led}\PYG{o}{.}\PYG{n}{on}\PYG{p}{(}\PYG{p}{)}
        \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
        \PYG{n}{led}\PYG{o}{.}\PYG{n}{off}\PYG{p}{(}\PYG{p}{)}
        \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}


\section{SIoT}
\label{\detokenize{05.soft/5.6-SIoT:siot}}\label{\detokenize{05.soft/5.6-SIoT::doc}}
SIoT是一款为中小学STEM教育定制的开源MQTT服务器程序，S指科学（Science）、简单（Simple）的意思。SIoT支持Win10、Win7、Mac和Linux等操作系统，一键启动，无需注册和设置即可使用。

SIoT是“虚谷计划”旗下“虚谷物联”项目的核心软件。虚谷号上内置了SIoT，可以将虚谷号看作是一个标准的MQTT服务器。

SIoT使用文档：
\sphinxurl{https://siot.readthedocs.io/}


\chapter{虚谷号的教育应用}
\label{\detokenize{06.edu/index:id1}}\label{\detokenize{06.edu/index::doc}}
这一部分主要介绍虚谷号的教育应用案例。用虚谷号可以做各种有趣应用，如人工智能、物联网、互动媒体、智能家居等


\section{虚谷号和人工智能}
\label{\detokenize{06.edu/6.1:id1}}\label{\detokenize{06.edu/6.1::doc}}

\section{虚谷号和物联网}
\label{\detokenize{06.edu/6.2:id1}}\label{\detokenize{06.edu/6.2::doc}}

\section{虚谷号和互动媒体}
\label{\detokenize{06.edu/6.3:id1}}\label{\detokenize{06.edu/6.3::doc}}

\section{虚谷号和智能家居}
\label{\detokenize{06.edu/6.4:id1}}\label{\detokenize{06.edu/6.4::doc}}

\chapter{虚谷号的扩展硬件}
\label{\detokenize{07.plus/index:id1}}\label{\detokenize{07.plus/index::doc}}
这一部分主要介绍虚谷号的各种扩展硬件。虚谷号内置了328P芯片，硬件上支持Arduino UNO的所有扩展硬件资源。借助USB口，各种免驱的硬件都可以接入，如摄像头、键盘、鼠标等。除此之外，一些创客企业也为其设计了更多的专属扩展硬件。


\section{“厚物”扩展板}
\label{\detokenize{07.plus/7.1-houwu:id1}}\label{\detokenize{07.plus/7.1-houwu::doc}}
虚怀若谷，厚德载物。厚物——虚谷号第一块多功能扩展板，外扩虚谷号通用I/O管脚，兼容DFRobot Gravity 3-Pin传感器接口，可外接众多传感器及模组。围绕国家“新时代，新课标，新课堂”课改要求，针对学校电子信息课实际教学场景，主打编程教学体验。

虚谷号是中国电子学会创客教育专家委员会针对中国创客教育现状设计的一块符合中国情的开源硬件控制器。满足现有的基础教育需求，兼容市场主流开源硬件，集Arduino，树莓派，micro:bit等优点于一身，兼具高性能与高性价比。虚谷号面向人工智能教育，采用中国芯片，打造中国版开源硬件——虚怀若谷，包容一切！


\subsection{简介}
\label{\detokenize{07.plus/7.1-houwu:id2}}
厚物扩展板，集成一组双路电机驱动，0.96英寸OLED12864显示屏，无源蜂鸣器及一列RGB全彩LED灯，满足现场教学应用及比赛场景设计。支持电机外接供电，满足机器人等应用场景；OLED既可作为Linux调试窗口，又可作为传感器数据显示来用；蜂鸣器及RGB全彩LED灯可贴合实际交通信号指示灯场景，满足课程教学应用。板载五向开关及A/B按键设计，可作程序调试开关使用。


\subsection{特性}
\label{\detokenize{07.plus/7.1-houwu:id3}}\begin{itemize}
\item {} 
双路电机驱动

\item {} 
OLED显示

\item {} 
一列三个RGB LED

\item {} 
蜂鸣器提醒

\item {} 
五向开关及A/B调试按钮

\item {} 
兼容Gravity传感器

\end{itemize}


\subsection{技术规格}
\label{\detokenize{07.plus/7.1-houwu:id4}}\begin{itemize}
\item {} 
兼容主板：虚谷号

\item {} 
工作电压：3.3V/5V兼容

\item {} 
电机驱动：TB6612FNG

\item {} 
驱动电流：1.2A连续电流；2A/3.2A启动电流(连续脉冲/单脉冲)

\item {} 
电机外接供电：\textless{}12V

\item {} 
OLED屏幕尺寸：0.96英寸

\item {} 
OLED屏幕分辨率：128x64

\item {} 
无源蜂鸣器

\item {} 
RGB LED x3

\item {} 
五向开关按键（A0口）

\item {} 
A/B按键调试按键（默认下拉）

\item {} 
尺寸：53.5*85.5mm

\end{itemize}


\subsection{引脚说明}
\label{\detokenize{07.plus/7.1-houwu:id5}}
\noindent\sphinxincludegraphics{{houwu01}.png}

\noindent\sphinxincludegraphics{{houwu02}.png}


\subsection{使用教程}
\label{\detokenize{07.plus/7.1-houwu:id6}}
本教程会对扩展板基础功能做必要的解释和说明。

\sphinxstylestrong{准备}

硬件：

1 x 虚谷号控制板
1 x 厚物扩展板

软件：
Arduino IDE（虚谷号自带）

将厚物扩展板插到虚谷号上，虚谷号通电（推荐5V@2A USB供电）。


\subsection{功能清单}
\label{\detokenize{07.plus/7.1-houwu:id7}}\begin{itemize}
\item {} 
点亮OLED屏幕

\item {} 
RGB全彩LED灯

\item {} 
无源蜂鸣器

\item {} 
按键

\item {} 
电机驱动（需外接电源至M\_Vin口）

\end{itemize}

功能源码下载：\sphinxurl{http://wiki.dfrobot.com.cn/index.php?title=(SKU:\_DFR0593)\_\%E5\%8E\%9A\%E7\%89\%A9\%E2\%80\%94\%E2\%80\%94\%E8\%99\%9A\%E8\%B0\%B7\%E5\%8F\%B7\%E6\%89\%A9\%E5\%B1\%95\%E6\%9D\%BF}


\section{摄像头}
\label{\detokenize{07.plus/7.2:id1}}\label{\detokenize{07.plus/7.2::doc}}

\section{声卡}
\label{\detokenize{07.plus/7.3:id1}}\label{\detokenize{07.plus/7.3::doc}}

\chapter{虚谷号的高级操作}
\label{\detokenize{08.advanced/index:id1}}\label{\detokenize{08.advanced/index::doc}}
这一部分主要介绍虚谷号的高级操作，如常见的故障解决、U盘目录详解、硬件资源详解等。


\section{常见故障解答}
\label{\detokenize{08.advanced/8.1:id1}}\label{\detokenize{08.advanced/8.1::doc}}

\section{U盘目录详解}
\label{\detokenize{08.advanced/8.2:u}}\label{\detokenize{08.advanced/8.2::doc}}

\section{虚谷号硬件资源详解}
\label{\detokenize{08.advanced/8.3:id1}}\label{\detokenize{08.advanced/8.3::doc}}
虚谷号除了引出全部的Arduino引脚外，还引出了主芯片的部分引脚。


\subsection{虚谷号的引脚说明}
\label{\detokenize{08.advanced/8.3:id2}}
1, CVBS\_OUT, 复合视频信号输出：输出视频信号到TV，LCD等，可用于将虚谷号扩展成视频盒子等；
2，ADC，虚谷号的ADC PIN：可以扩展更多的功能按键，也可用于ADC采样；
3，TX/RX，虚谷号的debug串口：虚谷号使用者的开发接口，系统信息的打印接口；
4，IR\_R：1， 红外（遥控）信息的输入接口；2，虚谷号GPIO口，扩展单线通信接口或虚谷号模拟PWM输出控制；
5，SPDIF：1，数字音频接口，用于驱动数字声卡（支持Dolby音效或DTS环绕音效）；2，虚谷号GPIO口，扩展单线通信或虚谷号模拟PWM输出控制；
6，AOL/AOR：虚谷号audio codec的音频模拟信号输出（左右声道），可用于将虚谷号扩展成视频盒子的音频输出或用于将虚谷号扩展为智能音箱等。

\noindent\sphinxincludegraphics{{gpio}.png}


\chapter{虚谷号的案例汇集}
\label{\detokenize{09.case/index:id1}}\label{\detokenize{09.case/index::doc}}
这一部分主要介绍一些使用虚谷号制作的案例。这些案例一般由国内创客和一线教师设计开发，涉及人工智能、物联网等方面。


\section{虚谷号结合Yeelight做”变色龙“灯}
\label{\detokenize{09.case/9.1-yeelight:yeelight}}\label{\detokenize{09.case/9.1-yeelight::doc}}
支持手机APP控制的智能灯泡很多, 但是能够让用户自行编程控制的却寥寥无几。研究了市场上常见的开放接口的智能灯泡, 总结出自定义编程大致有两种方式:一是智能灯泡的物联网网关支持第三方认证接入, 如天猫精灵;二是智能灯泡同时支持局域网内部的控制, 如Yeelight。

默认情况下，yeelight智能灯泡与物联网网关建立联系，然后手机App通过网关发送控制指令给灯泡，每一个智能灯泡都是一个智能终端。但是，yeelight智能灯泡如果开启了“局域网控制”功能，那么就可以同时响应来自局域网任一智能设备的控制指令了，发送控制指令的设备可以是电脑、手机，也可以是任何一个支持网络功能的MCU，如掌控板、虚谷号和树莓派等。


\subsection{案例描述}
\label{\detokenize{09.case/9.1-yeelight:id1}}
我们能利用虚谷号和智能灯泡做出怎样的案例呢？DF论坛上有人发了一篇关于制作“变色龙”的文章，大都是利用RGB全彩LED灯珠或灯带，结合颜色识别传感器，做能够根据环境颜色发出不同光芒的“变色龙”。这一作品激起很多创客的兴趣，于是大家就进一步改造，让这个“会变色”的作品越来越好玩。

这类变色主题的作品再多，也无非是利用了颜色传感器，控制的还是REG灯，在我们看来都不够好玩。在研究利用Wi-Fi控制互联网智能灯泡的过程中，我们发现只要遵循一定的协议，控制物联网家电并非难事。于是，我们想到了利用虚谷号来控制Yeelight灯泡，做一个智能变色灯。和其他作品不同的是，我们用摄像头或者高拍仪来代替颜色传感器，控制的是220V的“真正灯泡”。


\subsection{原理分析}
\label{\detokenize{09.case/9.1-yeelight:id2}}
之所以用摄像头来替代颜色传感器，是因为前者不仅便宜，而且随处可以获取。利用摄像头获取颜色，可以借助于Python中OpenCV库，调用摄像头拍照，并对拍到的图像进行处理分析，将图像中的主要颜色分解为RGB三种颜色数值，再通过局域网发送控制指令使智能灯泡变色。Yeeligh灯泡支持局域网控制，能够接收到局域网内任一智能设备的控制指令，用虚谷号控制智能灯泡的原理，这里不作详细介绍。

这个智能变色灯需要的器材很少，只需要虚谷号加yeelight智能灯泡、摄像头就可以了，作品的工作流程图如下。

\noindent\sphinxincludegraphics{{yeelight01}.png}


\subsection{用摄像头获取物体颜色的代码实现}
\label{\detokenize{09.case/9.1-yeelight:id3}}
摄像头前物体是什么颜色？看起来问题很简单，但是让计算机来回答并不容易。当我们要判断某个物体是什么颜色的时候，往往会先找出这一物体的最主要颜色，再判断这一颜色和哪种颜色最接近。计算机虽然说不出天蓝、橘黄之类的色彩名词，但可以精确地分析出图像中某一个像素点的RGB值，即RGB三种颜色的具体组成，但一个物体往往不会是纯色的，所以要确定一张含有多种颜色的图像的“颜色”，需要确定一个算法。

算法一：将这个图像的所有像素点的RGB值分别相加，取出RGB三种颜色的平均值。如果担心计算的效率太低，可以均匀地取出部分像素，应该可以得到大致的颜色平均值。

算法二：利用滤镜功能，给这个图像加上RGB三种颜色遮罩，处理为黑白图片，然后通过计算分别得到图像的白色区域面积大小，换算为0-255之间的数值。

\noindent\sphinxincludegraphics{{yeelight02}.png}

其实，这两种算法的原理是差不多的，只不过实现的方式不一样。OpenCV库作为著名的跨平台计算机视觉库，提供了很多图像处理和计算机视觉方面的通用算法，可以很简单地帮我们完成颜色分析的功能。


\subsection{算法一（遮罩法）部分代码：}
\label{\detokenize{09.case/9.1-yeelight:id4}}
\noindent\sphinxincludegraphics{{yeelight03}.png}


\subsection{算法二（取点法）部分代码：}
\label{\detokenize{09.case/9.1-yeelight:id5}}
\noindent\sphinxincludegraphics{{yeelight04}.png}


\subsection{虚谷号控制物联网灯泡的代码实现}
\label{\detokenize{09.case/9.1-yeelight:id6}}
为方便用户控制灯泡，Yeelight公司提供的一个小型库，可让用户通过Wi-Fi发送指令来控制Yeelight灯泡。只要获取了设备的IP地址，通过ON、OFF、Set\_Color等简单的函数，就能调整灯泡的开关、颜色、亮度等参数。

需要强调的是，Yeelight灯泡要开启“局域网控制”功能，默认情况下这一功能是关闭的。另外，虚谷号和Yeelight灯泡一定要处于同一局域网，即连接同一个无线路由器，才能通过指令来找到设备的IP地址。

控制灯泡颜色的参考代码如下：

\noindent\sphinxincludegraphics{{yeelight05}.png}

我们在虚谷号的论坛中，提供了更多关于Yeelight库的教程，可以在”创意项目”中找到，地址如下：
\sphinxurl{http://vvboard.net.cn/bbs/}


\subsection{实例运行}
\label{\detokenize{09.case/9.1-yeelight:id7}}
\noindent\sphinxincludegraphics{{yeelight06}.png}


\subsection{关于yeelight控制的课程}
\label{\detokenize{09.case/9.1-yeelight:id8}}
我们还提供了有关yeelight灯泡的一系列课程，可以在github上下载

\sphinxurl{https://github.com/vvlink/yeelight}

利用yeelight，我们还可以完成各种有趣的综合案例，比如：语音智能灯（麦克风、百度AI）用语音控制开灯、关灯和亮度等指令；天气灯，定时自动获取天气，设置相应的灯泡颜色；调色灯，使用python调色盘控制RGB数值等等。


\section{做一个颜值测试器}
\label{\detokenize{09.case/9.2-facetest:id1}}\label{\detokenize{09.case/9.2-facetest::doc}}

\subsection{案例描述}
\label{\detokenize{09.case/9.2-facetest:id2}}

\subsection{原理分析}
\label{\detokenize{09.case/9.2-facetest:id3}}

\subsection{用摄像头获取颜值的代码实现}
\label{\detokenize{09.case/9.2-facetest:id4}}


\renewcommand{\indexname}{Index}
\printindex
\end{document}